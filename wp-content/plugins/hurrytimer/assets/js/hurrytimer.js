"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}!function(c){var r=[" ",">","+","~"],a=["+","~"],o=["ATTR","PSEUDO","ID","CLASS"];function u(e,t,i){this.selector=e.trim(),this.callback=t,this.options=i,function(e){if(!c.find.tokenize)return e.isCombinatorial=!0,e.isFraternal=!0,e.isComplex=!0;e.isCombinatorial=!1,e.isFraternal=!1,e.isComplex=!1;for(var t=c.find.tokenize(e.selector),i=0;i<t.length;i++)for(var n=0;n<t[i].length;n++)-1!=r.indexOf(t[i][n].type)&&(e.isCombinatorial=!0),-1!=a.indexOf(t[i][n].type)&&(e.isFraternal=!0),-1!=o.indexOf(t[i][n].type)&&(e.isComplex=!0)}(this)}var n=[];n.initialize=function(e,t,i){function n(){-1==r.indexOf(this)&&(r.push(this),c(this).each(t))}var r=[];c(i.target).find(e).each(n);var a=new u(e,n,i);this.push(a);var o=new MutationObserver(function(e){for(var t=[],i=0;i<e.length;i++)if("attributes"==e[i].type&&(e[i].target.matches(a.selector)&&t.push(e[i].target),a.isFraternal?t.push.apply(t,e[i].target.parentElement.querySelectorAll(a.selector)):t.push.apply(t,e[i].target.querySelectorAll(a.selector))),"childList"==e[i].type)for(var n=0;n<e[i].addedNodes.length;n++)e[i].addedNodes[n]instanceof Element&&(e[i].addedNodes[n].matches(a.selector)&&t.push(e[i].addedNodes[n]),a.isFraternal?t.push.apply(t,e[i].addedNodes[n].parentElement.querySelectorAll(a.selector)):t.push.apply(t,e[i].addedNodes[n].querySelectorAll(a.selector)));for(var r=0;r<t.length;r++)c(t[r]).each(a.callback)}),s={childList:!0,subtree:!0,attributes:a.isComplex};return o.observe(i.target,i.observer||s),o},c.fn.initialize=function(e,t){return n.initialize(this.selector,e,c.extend({},c.initialize.defaults,t))},c.initialize=function(e,t,i){return n.initialize(e,t,c.extend({},c.initialize.defaults,i))},c.initialize.defaults={target:document.documentElement,observer:null}}(jQuery);var HurrytimerAction=function(){function t(e){_classCallCheck(this,t),this.elementRef=e}return _createClass(t,[{key:"changeStockStatus",value:function(e,t){jQuery.post&&jQuery.post(hurrytimer_ajax_object.ajax_url,{nonce:hurrytimer_ajax_object.ajax_nonce,action:"change_stock_status",status:t,campaign_id:e})}},{key:"hide",value:function(){if(!this.elementRef.find(".hurrytimer-campaign-message").length){var e=this.elementRef.closest(".hurrytimer-sticky");e.length?e.remove():this.elementRef.remove()}}},{key:"displayMessage",value:function(e){var t='<div class="hurrytimer-campaign-message">'.concat(e,"</div>");this.elementRef.html(t)}}],[{key:"redirect",value:function(e){document.body.style.opacity="0",document.body.style.display="none",hurrytimer_ajax_object.redirect_no_back?window.location.replace(e):window.location.href=e}},{key:"hideAddToCartButton",value:function(){var e=document.querySelector(".single_add_to_cart_button");e&&e.remove()}}]),t}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var HurrytimerCampaign=function(){function i(e,t){_classCallCheck(this,i),this.config=t,this.elementRef=e,this.actionsOptions=hurrytimer_ajax_object.actionsOptions,this.restartOptions=hurrytimer_ajax_object.restartOptions,this.recurTimeoutId=-1,this.retryCount=0,this.startEventDispatched=!1}return _createClass(i,[{key:"setCookie",value:function(e){Cookies.set(this.config.cookieName,e,{expires:365})}},{key:"getEndDate",value:function(){if(this.config.isRegular)return new Date(this.config.endDate);var e=new Date(parseInt(this.config.endDate));return this.isValidDate(e)&&this.config.endDate&&!this.allowReset()&&!this.allowRestart()||(this.unDismissStickyBar(),e=this.calculateDate()),this.setCookie(e.getTime()),this.sendTimestamp(),e}},{key:"isValidDate",value:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())}},{key:"sendTimestamp",value:function(){if(void 0!==jQuery.ajax){var e={url:hurrytimer_ajax_object.ajax_url,async:!0,type:"POST",data:{nonce:hurrytimer_ajax_object.ajax_nonce,timestamp:Cookies.get(this.config.cookieName),cid:this.config.id,action:"set_timestamp"}};jQuery.ajax(e)}}},{key:"allowReset",value:function(){return this.config.reset}},{key:"unDismissStickyBar",value:function(){Cookies.remove("_ht_CDT-".concat(this.config.id,"_dismissed"))}},{key:"allowRestart",value:function(){return!this.config.isRegular&&(this.isExpired()&&(this.allowRestartImmediately()||this.allowRestartAfterReload()))}},{key:"isExpired",value:function(){var e=new Date;return this.config.endDate<e}},{key:"allowRestartAfterReload",value:function(){return parseInt(this.config.restart)===parseInt(this.restartOptions.afterReload)}},{key:"allowRestartImmediately",value:function(){return parseInt(this.config.restart)===parseInt(this.restartOptions.immediately)}},{key:"hasAction",value:function(){return this.config.actions.length}},{key:"calculateDate",value:function(){var e=new Date;return e.setSeconds(e.getSeconds()+this.config.duration),e}},{key:"executeActions",value:function(){if(1===parseInt(hurrytimer_ajax_object.disable_actions))return!1;if(this.hasAction()){var e=!0,t=!1,i=void 0;try{for(var n,r=this.config.actions[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var a=n.value,o=new HurrytimerAction(this.elementRef);switch(a.id){case this.actionsOptions.redirect:HurrytimerAction.redirect(a.redirectUrl);break;case this.actionsOptions.hideAddToCartButton:HurrytimerAction.hideAddToCartButton();break;case this.actionsOptions.displayMessage:o.displayMessage(a.message);break;case this.actionsOptions.stockStatus:this.config.isRegular&&o.changeStockStatus(this.config.id,a.wcStockStatus);break;case this.actionsOptions.hide:o.hide()}}}catch(e){t=!0,i=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw i}}}}},{key:"maybeShowCampaign",value:function(){this.elementRef.length&&this.elementRef.removeClass("hurryt-loading");var e=this.elementRef.closest(".hurrytimer-sticky");e.length&&e.removeClass("hurryt-loading")}},{key:"run",value:function(){var t=this;this.triggerInitEvent(),this.elementRef.countdown(this.getEndDate(),function(e){return t.onCountdownUpdate(e)});var e=this.elementRef.closest(".hurrytimer-sticky");this.handleStickyBar(e)}},{key:"handleStickyBar",value:function(e){var t=this;0!==e.length&&(null==Cookies.get("_ht_CDT-".concat(this.config.id,"_dismissed"))?e.on("click",".hurrytimer-sticky-close",function(){return t.onStickyBarDismiss(e)}):this.hideStickyBar(e))}},{key:"hideStickyBar",value:function(e){if(0!==e.length){var t="0px"===e.css("top");e.remove(),t?jQuery("body").css("margin-top",0):jQuery("body").css("margin-bottom",0)}}},{key:"onStickyBarDismiss",value:function(e){this.hideStickyBar(e),Cookies.set("_ht_CDT-".concat(this.config.id,"_dismissed"),"1",{expires:+hurrytimer_ajax_object.sticky_bar_hide_timeout})}},{key:"onCountdownUpdate",value:function(e){this.render(e),this.maybeShowCampaign(),e.elapsed&&"finish"===e.type&&(this.triggerFinishEvent(),this.executeActions(),this.maybeRecur(),this.allowRestartImmediately()&&this.run())}},{key:"triggerFinishEvent",value:function(){var e={id:this.config.id,mode:this.config.mode,endAt:this.config.endDate};this.elementRef.trigger("hurryt:finished",e)}},{key:"triggerInitEvent",value:function(){var e={id:this.config.id,mode:this.config.mode,endAt:this.config.endDate};jQuery(".hurrytimer-campaign").trigger("hurryt:init",e)}},{key:"triggerStartEvent",value:function(){if(!this.startEventDispatched){var e={id:this.config.id,mode:this.config.mode,endAt:this.config.endDate};this.elementRef.trigger("hurryt:started",e),this.startEventDispatched=!0}}},{key:"render",value:function(e){this.elementRef.find(".hurrytimer-timer").html(e.strftime(this.config.template)),this.triggerStartEvent()}},{key:"maybeRecur",value:function(){var i=this;this.config.recurr&&void 0!==jQuery.ajax&&(clearTimeout(this.recurTimeoutId),this.recurTimeoutId=setTimeout(function(){jQuery.ajax({url:hurrytimer_ajax_object.ajax_url,data:{action:"next_recurrence",nonce:hurrytimer_ajax_object.ajax_nonce,id:i.config.id},error:function(){10!==i.retryCount&&(i.retryCount++,setTimeout(function(){i.maybeRecur()},1e3))},success:function(e){var t=e.data;i.retryCount=0,t&&(isNaN(t.endTimestamp)||(i.config.endDate=t.endTimestamp,i.run()))}})},1e3*this.config.timeToNextRecurrence))}}]),i}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(n){var r=n("body");n.initialize(".hurrytimer-campaign",function(){!function(e){var t=e.data("config");if(void 0===t)return;"object"!==_typeof(t)&&(t=JSON.parse(t.replace(/\s+/g," ")));e.removeAttr("data-config"),e.trigger("hurryt:pre-init",{id:t.id,mode:t.mode,endAt:t.endAt});var i=e.closest(".hurrytimer-sticky");i.length&&(r.append(i),n(window).resize(function(){"0px"===i.css("top")?r.css("margin-top",i.outerHeight()):r.css("margin-bottom",i.outerHeight())}),setTimeout(function(){n(window).trigger("resize")}));new HurrytimerCampaign(e,t).run()}(n(this))})}(jQuery);